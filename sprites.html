<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jump Ultimate Stars - Avec Sprites</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #gameCanvas {
            border: 3px solid #0e4b99;
            background: linear-gradient(180deg, #87CEEB 0%, #98FB98 100%);
            box-shadow: 0 0 20px rgba(14, 75, 153, 0.5);
        }
        
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        
        #gameInfo {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            text-align: right;
        }
        
        .start-button {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .start-button:hover {
            background: #c0392b;
        }
        
        #log {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        #loadingStatus {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="1200" height="800"></canvas>
        
        <div id="controls">
            <strong>Contr√¥les:</strong><br>
            Joueur 1 (Ninja): WASD + G (attaque)<br>
            Joueur 2 (Warrior): ‚Üë‚Üì‚Üê‚Üí + L (attaque)<br>
            R: Red√©marrer | P: Pause
        </div>
        
        <div id="gameInfo">
            <div>Sant√© P1: <span id="p1Health">100</span>%</div>
            <div>Sant√© P2: <span id="p2Health">100</span>%</div>
            <div>Temps: <span id="gameTimer">99</span>s</div>
        </div>
        
        <div id="log">
            <strong>Log:</strong><br>
            <div id="logContent"></div>
        </div>
        
        <div id="loadingStatus">
            <h3>Chargement des sprites...</h3>
            <div id="loadingProgress">0%</div>
        </div>
        
        <button class="start-button" onclick="startGame()">COMMENCER LE COMBAT !</button>
    </div>

    <script>
        // Variables globales
        let canvas, ctx;
        let gameRunning = false;
        let players = [];
        let keys = {};
        let lastTime = 0;
        let assetsLoaded = false;
        let sprites = {};
        
        // Fonction de log
        function log(message) {
            console.log(message);
            const logContent = document.getElementById('logContent');
            logContent.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            logContent.scrollTop = logContent.scrollHeight;
        }
        
        // Gestionnaire de sprites simplifi√©
        class SimpleAssetManager {
            constructor() {
                this.images = {};
                this.loaded = 0;
                this.total = 0;
            }
            
            async loadImage(id, src) {
                return new Promise((resolve) => {
                    this.total++;
                    const img = new Image();
                    
                    img.onload = () => {
                        this.images[id] = img;
                        this.loaded++;
                        this.updateProgress();
                        log(`‚úì ${id} charg√© (${img.width}x${img.height})`);
                        resolve(img);
                    };
                    
                    img.onerror = () => {
                        // Cr√©er une image de remplacement
                        const placeholder = this.createPlaceholder(id);
                        this.images[id] = placeholder;
                        this.loaded++;
                        this.updateProgress();
                        log(`‚ö† ${id} - utilisation du placeholder`);
                        resolve(placeholder);
                    };
                    
                    img.src = src;
                });
            }
            
            createPlaceholder(id) {
                const canvas = document.createElement('canvas');
                canvas.width = 64;
                canvas.height = 64;
                const ctx = canvas.getContext('2d');
                
                // Couleur selon le type
                const colors = {
                    'ninja_idle': '#2c3e50',
                    'ninja_walk': '#34495e',
                    'ninja_jump': '#2c3e50',
                    'ninja_attack': '#e74c3c',
                    'ninja_hurt': '#c0392b',
                    'warrior_idle': '#e74c3c',
                    'warrior_walk': '#c0392b',
                    'warrior_jump': '#e74c3c',
                    'warrior_attack': '#a93226',
                    'warrior_hurt': '#922b21'
                };
                
                const color = colors[id] || '#95a5a6';
                
                // Dessiner le placeholder
                ctx.fillStyle = color;
                ctx.fillRect(0, 0, 64, 64);
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.strokeRect(0, 0, 64, 64);
                
                // Ajouter une lettre
                ctx.fillStyle = '#ffffff';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                const letter = id.includes('ninja') ? 'N' : 'W';
                ctx.fillText(letter, 32, 38);
                
                const img = new Image();
                img.src = canvas.toDataURL();
                return img;
            }
            
            updateProgress() {
                const percentage = this.total > 0 ? Math.round((this.loaded / this.total) * 100) : 0;
                document.getElementById('loadingProgress').textContent = `${percentage}% (${this.loaded}/${this.total})`;
                
                if (this.loaded === this.total) {
                    setTimeout(() => {
                        document.getElementById('loadingStatus').style.display = 'none';
                        assetsLoaded = true;
                        log('üéÆ Tous les sprites charg√©s ! Pr√™t √† jouer !');
                    }, 500);
                }
            }
            
            getImage(id) {
                return this.images[id];
            }
            
            async loadAllAssets() {
                log('üì¶ D√©but du chargement des sprites...');
                
                const characterTypes = ['ninja', 'warrior'];
                const animations = ['idle', 'walk', 'jump', 'attack', 'hurt'];
                
                const loadPromises = [];
                
                for (const type of characterTypes) {
                    for (const anim of animations) {
                        const id = `${type}_${anim}`;
                        const src = `./assets/characters/${type}_${anim}.png?v=${Date.now()}`;
                        loadPromises.push(this.loadImage(id, src));
                    }
                }
                
                await Promise.all(loadPromises);
                log('‚úÖ Chargement termin√© !');
            }
        }
        
        // Classe joueur avec sprites
        class PlayerWithSprites {
            constructor(x, y, type, isPlayer1) {
                this.x = x;
                this.y = y;
                this.width = 80;  // Plus gros pour √™tre bien visible
                this.height = 80; // Plus gros pour √™tre bien visible
                this.type = type; // 'ninja' ou 'warrior'
                this.isPlayer1 = isPlayer1;
                this.health = 100;
                this.maxHealth = 100;
                this.facingLeft = false;
                
                // Animation
                this.currentAnimation = 'idle';
                this.animationTime = 0;
                this.animationSpeed = 0.005; // Plus lent
                
                // Physique
                this.vx = 0;
                this.vy = 0;
                this.onGround = false;
                this.speed = 300;
                this.jumpPower = 500;
                this.gravity = 1500;
                
                // Combat
                this.isAttacking = false;
                this.attackTimer = 0;
                this.attackDuration = 300;
                this.hasHit = false;
                
                log(`ü•∑ Joueur ${isPlayer1 ? 1 : 2} (${type}) cr√©√©`);
            }
            
            update(deltaTime) {
                const dt = deltaTime / 1000;
                
                // Sauvegarder l'ancienne animation
                const oldAnimation = this.currentAnimation;
                
                // Input et animation
                if (this.isPlayer1) {
                    if (keys['KeyA']) {
                        this.vx = -this.speed;
                        this.facingLeft = true;
                        this.currentAnimation = 'walk';
                    } else if (keys['KeyD']) {
                        this.vx = this.speed;
                        this.facingLeft = false;
                        this.currentAnimation = 'walk';
                    } else {
                        this.vx = 0;
                        if (this.onGround && !this.isAttacking) {
                            this.currentAnimation = 'idle';
                        }
                    }
                    
                    if (keys['KeyW'] && this.onGround) {
                        this.vy = -this.jumpPower;
                        this.onGround = false;
                        this.currentAnimation = 'jump';
                    }
                    
                    if (keys['KeyG'] && !this.isAttacking) {
                        this.attack();
                    }
                } else {
                    if (keys['ArrowLeft']) {
                        this.vx = -this.speed;
                        this.facingLeft = true;
                        this.currentAnimation = 'walk';
                    } else if (keys['ArrowRight']) {
                        this.vx = this.speed;
                        this.facingLeft = false;
                        this.currentAnimation = 'walk';
                    } else {
                        this.vx = 0;
                        if (this.onGround && !this.isAttacking) {
                            this.currentAnimation = 'idle';
                        }
                    }
                    
                    if (keys['ArrowUp'] && this.onGround) {
                        this.vy = -this.jumpPower;
                        this.onGround = false;
                        this.currentAnimation = 'jump';
                    }
                    
                    if (keys['KeyL'] && !this.isAttacking) {
                        this.attack();
                    }
                }
                
                // Reset timer si animation change
                if (oldAnimation !== this.currentAnimation) {
                    this.animationTime = 0;
                }
                
                // Mettre √† jour le timer d'animation
                this.animationTime += deltaTime * this.animationSpeed;
                
                // Physique
                this.vy += this.gravity * dt;
                this.x += this.vx * dt;
                this.y += this.vy * dt;
                
                // Collision avec le sol
                if (this.y + this.height > 700) {
                    this.y = 700 - this.height;
                    this.vy = 0;
                    this.onGround = true;
                }
                
                // Collision avec les bords
                if (this.x < 0) this.x = 0;
                if (this.x + this.width > 1200) this.x = 1200 - this.width;
                
                // Combat
                if (this.isAttacking) {
                    this.attackTimer += deltaTime;
                    if (this.attackTimer >= this.attackDuration) {
                        this.isAttacking = false;
                        this.attackTimer = 0;
                        this.hasHit = false;
                        if (this.onGround) {
                            this.currentAnimation = 'idle';
                        }
                    }
                }
            }
            
            attack() {
                this.isAttacking = true;
                this.attackTimer = 0;
                this.hasHit = false;
                this.currentAnimation = 'attack';
                this.animationTime = 0;
                log(`‚öîÔ∏è ${this.type} attaque !`);
            }
            
            takeDamage(damage) {
                this.health -= damage;
                if (this.health < 0) this.health = 0;
                this.currentAnimation = 'hurt';
                this.animationTime = 0;
                log(`üí• ${this.type} prend ${damage} d√©g√¢ts ! Sant√©: ${this.health}`);
            }
            
            render(ctx) {
                if (assetsLoaded && assetManager) {
                    // Rendu avec sprite
                    const spriteId = `${this.type}_${this.currentAnimation}`;
                    const sprite = assetManager.getImage(spriteId);
                    
                    if (sprite) {
                        ctx.save();
                        
                        // Flip horizontal si n√©cessaire
                        if (this.facingLeft) {
                            ctx.scale(-1, 1);
                            ctx.drawImage(sprite, -this.x - this.width, this.y, this.width, this.height);
                        } else {
                            ctx.drawImage(sprite, this.x, this.y, this.width, this.height);
                        }
                        
                        ctx.restore();
                    } else {
                        // Fallback rectangle
                        this.renderRectangle(ctx);
                    }
                } else {
                    // Rendu rectangle pendant le chargement
                    this.renderRectangle(ctx);
                }
                
                // Barre de vie
                this.renderHealthBar(ctx);
                
                // Indicateur d'attaque
                if (this.isAttacking) {
                    ctx.fillStyle = 'rgba(255, 0, 0, 0.5)';
                    const attackX = this.facingLeft ? this.x - 25 : this.x + this.width;
                    ctx.fillRect(attackX, this.y + 10, 25, 40);
                }
            }
            
            renderRectangle(ctx) {
                const color = this.type === 'ninja' ? '#2c3e50' : '#e74c3c';
                ctx.fillStyle = color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x, this.y, this.width, this.height);
            }
            
            renderHealthBar(ctx) {
                const barWidth = this.width;
                const barHeight = 6;
                const barX = this.x;
                const barY = this.y - 15;
                
                // Fond
                ctx.fillStyle = 'red';
                ctx.fillRect(barX, barY, barWidth, barHeight);
                
                // Vie
                ctx.fillStyle = 'green';
                const healthWidth = (this.health / this.maxHealth) * barWidth;
                ctx.fillRect(barX, barY, healthWidth, barHeight);
                
                // Bordure
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 1;
                ctx.strokeRect(barX, barY, barWidth, barHeight);
            }
        }
        
        // Variables globales pour les assets
        let assetManager;
        
        async function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            log('üéÆ Initialisation du jeu avec sprites...');
            
            // Cr√©er le gestionnaire d'assets
            assetManager = new SimpleAssetManager();
            
            // Charger les sprites
            await assetManager.loadAllAssets();
            
            // Cr√©er les joueurs
            players = [
                new PlayerWithSprites(200, 480, 'ninja', true),    // Ajust√© pour la nouvelle taille
                new PlayerWithSprites(1000, 480, 'warrior', false) // Ajust√© pour la nouvelle taille
            ];
            
            log('‚úÖ Jeu initialis√© avec sprites !');
        }
        
        function startGame() {
            if (gameRunning) return;
            
            gameRunning = true;
            log('üöÄ D√©marrage du combat avec sprites !');
            
            // Cacher le bouton
            document.querySelector('.start-button').style.display = 'none';
            
            // D√©marrer la boucle de jeu
            lastTime = 0;
            requestAnimationFrame(gameLoop);
        }
        
        function gameLoop(currentTime) {
            if (!gameRunning) return;
            
            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;
            
            update(deltaTime);
            render();
            
            requestAnimationFrame(gameLoop);
        }
        
        function update(deltaTime) {
            // Mettre √† jour les joueurs
            for (const player of players) {
                player.update(deltaTime);
            }
            
            // Combat
            const [p1, p2] = players;
            const distance = Math.abs(p1.x - p2.x);
            
            if (distance < 80) {
                if (p1.isAttacking && !p1.hasHit) {
                    p2.takeDamage(15);
                    p1.hasHit = true;
                    p2.vx = p2.x > p1.x ? 200 : -200;
                }
                if (p2.isAttacking && !p2.hasHit) {
                    p1.takeDamage(15);
                    p2.hasHit = true;
                    p1.vx = p1.x > p2.x ? 200 : -200;
                }
            }
            
            // Interface
            document.getElementById('p1Health').textContent = Math.round(p1.health);
            document.getElementById('p2Health').textContent = Math.round(p2.health);
            
            // Victoire
            if (p1.health <= 0) {
                endGame('üèÜ Joueur 2 (Warrior) gagne !');
            } else if (p2.health <= 0) {
                endGame('üèÜ Joueur 1 (Ninja) gagne !');
            }
        }
        
        function render() {
            // Effacer
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Arri√®re-plan
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#98FB98');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Sol
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, 700, canvas.width, 100);
            
            // Plateformes
            ctx.fillStyle = '#654321';
            ctx.fillRect(300, 550, 200, 20);
            ctx.fillRect(700, 400, 200, 20);
            ctx.fillRect(500, 300, 200, 20);
            
            // Joueurs
            for (const player of players) {
                player.render(ctx);
            }
        }
        
        function endGame(message) {
            gameRunning = false;
            log('üéØ ' + message);
            setTimeout(() => {
                alert(message + '\nAppuyez sur R pour rejouer !');
            }, 100);
        }
        
        // √âv√©nements
        window.addEventListener('load', init);
        
        window.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            
            if (e.code === 'KeyR') {
                location.reload();
            } else if (e.code === 'KeyP') {
                gameRunning = !gameRunning;
                if (gameRunning) requestAnimationFrame(gameLoop);
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });
    </script>
</body>
</html>